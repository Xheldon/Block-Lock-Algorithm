# 基于 block 的实时协同算法的实现

## 要解决的问题

1. 基于锁的协同不算是协同，因为它们并不实时
2. 基于 OT 的文档协同的算法，如果想实现的好用，需要巨量的代码以及需要客户端、服务端同时支持，以解决最终一致性问题。

## 具体思路

因此，基于此，可以考虑基于 block 的锁定策略。即，当用户编辑某一个 block 的时候，它获取一个锁，以禁止他人编辑相同 block。同时像 google docs 一样，将用户名显示到文档中，表明当前已有人在编辑。

## 用到的技术

1. 锁定策略 以保持各个客户端锁定。
2. Websocks 以保持各个客户端通讯。
3. 基于文档 block 的简化版 OT/CRDT 算法
4. ProseMirror 框架中的基于 token 的坐标定位系统比较适合实现该算法。

## 可能的问题

如果一个文档只有两个段落，但是却有三个人在编辑，那么至少会有一个人需要等待，体验欠佳，因此，后续可以考虑基于标点符号的锁定策略。

## 参考文献

NO
